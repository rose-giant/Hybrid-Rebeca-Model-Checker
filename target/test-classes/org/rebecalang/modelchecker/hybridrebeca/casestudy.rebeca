
reactiveclass Sensor(2) {
    knownrebecs {
        CollisionMonitor cm;
    }

    statevars {
        int distance;
        int velocity;
    }

    Sensor() {
        self.sample();
    }

    msgsrv sample() {
        distance = 120;
        velocity = 2;

        cm.sensorData(distance, velocity) after(10, 30);

        self.sample() after(50, 100);
    }
}

reactiveclass CollisionMonitor(2) {
    knownrebecs {
        Controller ctrl;
    }

    msgsrv sensorData(int d, int v) {
        if (v > 0 && d / v <= 200) {
            ctrl.collisionDetected();
        }
    }
}

reactiveclass Controller(2) {

    statevars {
        boolean braking;
    }

    msgsrv collisionDetected() {
        braking = true;
        self.brake();
    }

    msgsrv brake() {

    }
}

main {
    Controller ctrl():();
    CollisionMonitor cm(ctrl):();
    Sensor s(cm):();
}

